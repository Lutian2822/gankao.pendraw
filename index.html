<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手绘动画生成器 V4</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
</head>
<body>

<header>
    <h1>DrawPen <span class="badge">V4.0</span></h1>
    <div style="display: flex; align-items: center; gap: 20px;">
        <div style="font-size: 14px; color: var(--text-secondary);">手绘动画生成器</div>
        <div class="theme-switch-wrapper">
            <button class="theme-switch" id="themeSwitchBtn" title="切换主题">
                <!-- Sun Icon -->
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" style="display: block;">
                    <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                </svg>
                <!-- Moon Icon -->
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" style="display: none;">
                    <path d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/>
                </svg>
            </button>
        </div>
    </div>
</header>

<div class="main-container">
    <!-- Workflow Area Left: Step 1 & 2 -->
    <div class="workflow-area workflow-area-left">
        
        <!-- Step 1 -->
        <div class="workflow-card" id="imageACard">
            <div class="card-header">
                <div class="card-title"><span class="card-number">1</span> 绘制目标</div>
                <div class="card-actions">
                    <button id="drawTemplateBtn" class="mini-action-btn" type="button">模板库</button>
                </div>
            </div>

            <div class="control-row">
                <div class="upload-zone" id="uploadAZone">
                    <div class="upload-placeholder">上传本地文件</div>
                    <canvas id="previewACanvas"></canvas>
                    <button class="image-close" id="clearImageABtn" type="button">&times;</button>
                </div>
                <input type="file" id="imageAInput" accept="image/*">
            </div>
            <div class="control-row" style="margin-top: 15px;">
                <label>对比度: <span id="contrastVal">0</span></label>
                <input type="range" id="contrastRange" min="-100" max="100" value="0">
            </div>
            <div class="control-row">
                <label>缩放比例: <span id="scaleVal">1.0</span></label>
                <input type="range" id="scaleRange" min="0.1" max="2.0" step="0.1" value="1.0">
            </div>
        </div>

        <!-- Step 2 -->
        <div class="workflow-card" id="imageBCard">
            <div class="card-header">
                <div class="card-title"><span class="card-number">2</span> 手写笔</div>
                <div class="card-actions">
                    <button id="penTemplateBtn" class="mini-action-btn" type="button">模板库</button>
                </div>
            </div>
            <div class="control-row">
                <div class="pen-preview-wrapper" id="penPreviewWrapper">
                    <div class="upload-zone" id="uploadBZone">
                        <div class="upload-placeholder">上传本地文件</div>
                        <canvas id="previewBCanvas"></canvas>
                        <button class="image-close" id="clearImageBBtn" type="button">&times;</button>
                    </div>
                    <div class="pen-actions">
                        <button id="penRelocateBtn" class="mini-action-btn" type="button">重新定位笔尖</button>
                    </div>
                </div>
                <input type="file" id="imageBInput" accept="image/*">
            </div>
            <p style="font-size: 12px; text-align: center; color: #888;">上传后请在图片上拖动或点击设定笔尖</p>
            
            <div class="control-row" style="margin-top: 15px;">
                <label>手的大小: <span id="handScaleVal">40</span>%</label>
                <input type="range" id="handScaleRange" min="10" max="100" value="40">
            </div>
            <div class="control-row">
                <label>手臂防抖: <span id="handSmoothVal">10</span></label>
                <input type="range" id="handSmoothRange" min="0" max="50" value="10">
            </div>
            <div class="control-row">
                <label>底部渐变高度: <span id="handFadeVal">0</span>%</label>
                <input type="range" id="handFadeRange" min="0" max="100" value="0">
            </div>
        </div>
        
    </div>

    <!-- Preview Area Center -->
    <div class="preview-area">
        <div class="canvas-wrapper">
            <canvas id="renderCanvas" width="1200" height="1600"></canvas>
        </div>
        <div style="margin-top: 15px; font-size: 12px; color: #999;">
            实时预览窗口 (1200x1600)
        </div>
    </div>

    <!-- Workflow Area Right: Step 3–5 -->
    <div class="workflow-area workflow-area-right">

        <!-- Step 3 -->
        <div class="workflow-card">
            <div class="card-header">
                <div class="card-title"><span class="card-number">3</span> 细节微调</div>
                <div class="card-actions">
                    <button id="detailModeToggle" class="mini-action-btn detail-mode-toggle" type="button">简易模式</button>
                </div>
            </div>
            
            <div class="control-row">
                <label>线条识别阈值: <span id="threshVal">200</span></label>
                <input type="range" id="thresholdRange" min="0" max="255" value="200">
            </div>

            <div class="control-row">
                <label>笔触粗细: <span id="strokeVal">6</span>px</label>
                <input type="range" id="strokeRange" min="1" max="30" value="6">
            </div>

            <div class="control-row detail-advanced-row" id="smoothRow">
                <label>平滑处理: <span id="smoothVal">5</span></label>
                <input type="range" id="smoothRange" min="0" max="20" value="5">
            </div>

            <div class="control-row detail-advanced-row" id="blurRow">
                <label>边缘柔化: <span id="blurVal">2</span></label>
                <input type="range" id="blurRange" min="0" max="20" value="2">
            </div>
            
            <div class="control-row detail-advanced-row" id="stepRow">
                <label>采样精度 (1=最细): <span id="stepVal">2</span></label>
                <input type="range" id="stepRange" min="1" max="5" step="1" value="2">
            </div>
            <div class="control-row detail-advanced-row" id="colorBrushRow">
                <label>涂抹画笔粗细: <span id="colorBrushVal">100</span>px</label>
                <input type="range" id="colorBrushRange" min="20" max="120" value="100">
            </div>
        </div>

        <!-- Step 4 -->
        <div class="workflow-card">
            <div class="card-header">
                <div class="card-title"><span class="card-number">4</span> 绘制逻辑</div>
                <div class="card-actions">
                    <button id="exportModeToggle" class="mini-action-btn detail-mode-toggle" type="button">简易模式</button>
                </div>
            </div>

            <div class="control-row export-advanced-row" id="tempOutlineRow">
                <div class="step-row">
                    <div class="step-index" id="tempOutlineStepIndex"></div>
                    <div class="step-content">
                        <label style="display: flex; align-items: center; font-size: 13px;">
                            <input type="checkbox" id="tempOutlineCheck" style="margin-right: 5px;"> 
                            彩色区域临时轮廓
                        </label>
                        <label style="display: flex; align-items: center; font-size: 13px; margin-top: 4px;">
                            <input type="checkbox" id="blackOutlineCheck" checked style="margin-right: 5px;"> 
                            黑色区域临时轮廓
                        </label>
                    </div>
                </div>
            </div>

            <div class="control-row" id="durationRow">
                <div class="step-row">
                    <div class="step-index" id="durationStepIndex">第1步</div>
                    <div class="step-content">
                        <label>
                            绘制线条:
                            <input type="number" id="durationInput" min="1" max="60" value="5" style="width: 50px; border: none; border-bottom: 1px solid #333; text-align: center;">
                            秒
                        </label>
                    </div>
                </div>
            </div>

            <div class="control-row export-advanced-row" id="colorFillRow">
                <div class="step-row">
                    <div class="step-index" id="colorFillStepIndex"></div>
                    <div class="step-content">
                        <label style="display: flex; align-items: center; font-size: 13px;">
                            <input type="checkbox" id="colorFillCheck" style="margin-right: 5px;"> 
                            彩色填充
                        </label>
                        <div class="inline-input">
                            <span>时长</span>
                            <input type="number" id="colorDurationInput" min="1" max="60" value="1">
                            <span>秒</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-row export-advanced-row" id="repairRow">
                <div class="step-row">
                    <div class="step-index" id="repairStepIndex"></div>
                    <div class="step-content">
                        <label style="display: flex; align-items: center; font-size: 13px;">
                            <input type="checkbox" id="repairCheck" checked style="margin-right: 5px;"> 
                            智能补全细节
                        </label>
                    </div>
                </div>
            </div>

            <div class="control-row" id="holdRow">
                <div class="step-row">
                    <div class="step-index" id="holdStepIndex">第2步</div>
                    <div class="step-content">
                        <label>
                            画完停留:
                            <input type="number" id="holdDurationInput" min="0" max="10" value="2" style="width: 50px; border: none; border-bottom: 1px solid #333; text-align: center;">
                            秒
                        </label>
                    </div>
                </div>
            </div>

            <div class="control-row export-advanced-row" id="orderRow">
                <div class="step-row">
                    <div class="step-index">顺序</div>
                    <div class="step-content">
                        <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 4px; font-size: 12px;">
                            <label style="display: flex; align-items: center;">
                                <input type="radio" name="drawOrder" id="orderLR" value="lr" checked style="margin-right: 4px;">
                                从左往右
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="radio" name="drawOrder" id="orderTB" value="tb" style="margin-right: 4px;">
                                从上往下
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="radio" name="drawOrder" id="orderRandom" value="random" style="margin-right: 4px;">
                                随机
                            </label>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Step 5 -->
        <div class="workflow-card">
            <div class="card-header">
                <div class="card-title"><span class="card-number">5</span> 生成导出</div>
            </div>

            <div class="control-row" id="fpsRow">
                <label>视频帧率 (FPS): 
                    <select id="fpsSelect" style="border: none; border-bottom: 1px solid #333; background: transparent;">
                        <option value="10">10 FPS</option>
                        <option value="24">24 FPS</option>
                        <option value="30" selected>30 FPS</option>
                        <option value="60">60 FPS</option>
                    </select>
                </label>
            </div>
            <div class="action-row">
                <button id="generateBtn" class="action-btn">生成</button>
                <button id="testBtn" class="action-btn mini-btn" type="button">测试</button>
                <button id="stopBtn" class="action-btn mini-btn" type="button" disabled>停止</button>
            </div>
        </div>

    </div>
</div>

<div class="status-indicator" id="statusIndicator">
    <div class="status-dot"></div>
    <span id="statusText">正在处理...</span>
</div>

<div class="video-overlay" id="videoOverlay">
    <div class="close-overlay" onclick="closeOverlay()">&times;</div>
    <div class="video-container">
        <h3 style="margin: 0 0 10px 0;">生成完成!</h3>
        <video id="resultVideo" controls style="max-width: 100%; max-height: 70vh;"></video>
        <a id="downloadLink" href="#" class="action-btn" style="text-align: center; text-decoration: none;">下载视频 (MP4)</a>
    </div>
</div>

<div class="template-modal" id="templateModal">
    <div class="template-modal-content">
        <div class="template-modal-header">
            <div id="templateModalTitle">选择模板图</div>
            <button class="template-modal-close" id="templateModalClose" type="button">&times;</button>
        </div>
        <div class="template-grid" id="templateGrid"></div>
    </div>
</div>

<div class="pen-tip-modal" id="penTipModal">
    <div class="pen-tip-content">
        <div class="pen-tip-title">请点击笔尖位置（默认在画面中间）</div>
        <div class="pen-tip-preview">
            <canvas id="penTipCanvas"></canvas>
        </div>
        <div class="pen-tip-actions">
            <button id="penTipCancel" class="mini-action-btn" type="button">取消</button>
            <button id="penTipConfirm" class="pen-tip-confirm" type="button">确定</button>
        </div>
    </div>
</div>

<script src="main.js"></script>

</body>
</html>
